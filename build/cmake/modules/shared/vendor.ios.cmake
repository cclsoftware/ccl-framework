include_guard (DIRECTORY)

include (vendor.clang)

# Installation directories
set (VENDOR_APPLICATION_RUNTIME_DIRECTORY ".." CACHE STRING "Bundle root" FORCE)
set (VENDOR_PLUGINS_RUNTIME_DIRECTORY "${VENDOR_APPLICATION_RUNTIME_DIRECTORY}/Frameworks" CACHE STRING "Plug-in installation directory" FORCE)
set (CMAKE_FIND_FRAMEWORK LAST)

# add default definitions
add_compile_definitions (
	"SOURCE_ROOT=$SRCROOT"
	"OSATOMIC_USE_INLINED=0"
	"$<$<CONFIG:DEBUG>:DEBUG=1>"
)

# add default compiler options
set (COMPILE_OPTIONS_CXX_C "")
list (APPEND COMPILE_OPTIONS_CXX_C
	"-fno-aligned-allocation"
	"-Wno-undefined-bool-conversion"
	"-Wno-expansion-to-defined"
)

foreach(flag_var ${COMPILE_OPTIONS_CXX_C})
	add_compile_options ($<$<COMPILE_LANGUAGE:CXX,C>:${flag_var}>)
endforeach()

# add default linker options
add_link_options (
	"$<$<CONFIG:DEBUG>:>"
	"$<$<CONFIG:RELEASE>:>"
)

# library name format
set (CMAKE_SHARED_MODULE_PREFIX "")
set (CMAKE_SHARED_LIBRARY_PREFIX "lib")
set (CMAKE_SHARED_LIBRARY_SUFFIX ".dylib")
set (CMAKE_SHARED_MODULE_SUFFIX ".dylib")
set (CMAKE_STATIC_LIBRARY_PREFIX "lib")

# additional settings for Xcode
set (CMAKE_XCODE_GENERATE_SCHEME "YES")

set (CMAKE_CONFIGURATION_TYPES "Release;Debug")

set (CMAKE_XCODE_ATTRIBUTE_ONLY_ACTIVE_ARCH "YES")

set (CMAKE_XCODE_ATTRIBUTE_SUPPORTS_MACCATALYST "NO")
set (CMAKE_XCODE_ATTRIBUTE_SUPPORTS_MAC_DESIGNED_FOR_IPHONE_IPAD "NO")
set (CMAKE_XCODE_ATTRIBUTE_ENABLE_BITCODE "NO>")

set (CMAKE_XCODE_ATTRIBUTE_CODE_SIGN_STYLE "Automatic")
set (CMAKE_XCODE_ATTRIBUTE_PROVISIONING_PROFILE_SPECIFIER "")

set (CMAKE_XCODE_ATTRIBUTE_LD_RUNPATH_SEARCH_PATHS "@loader_path/Frameworks")

set (CMAKE_XCODE_ATTRIBUTE_CLANG_CXX_LANGUAGE_STANDARD "c++${VENDOR_CXX_STANDARD}")

set (CMAKE_XCODE_ATTRIBUTE_GCC_OPTIMIZATION_LEVEL "$<IF:$<CONFIG:DEBUG>,0,s>")
set (CMAKE_XCODE_ATTRIBUTE_GCC_STRICT_ALIASING "YES")
set (CMAKE_XCODE_ATTRIBUTE_GCC_DYNAMIC_NO_PIC "NO")
set (CMAKE_XCODE_ATTRIBUTE_GCC_UNROLL_LOOPS "YES")
set (CMAKE_XCODE_ATTRIBUTE_GCC_ENABLE_CPP_EXCEPTIONS "YES")
set (CMAKE_XCODE_ATTRIBUTE_GCC_ENABLE_CPP_RTTI "NO")
set (CMAKE_XCODE_ATTRIBUTE_GCC_INLINES_ARE_PRIVATE_EXTERN "YES")
set (CMAKE_XCODE_ATTRIBUTE_GCC_SYMBOLS_PRIVATE_EXTERN "YES")
set (CMAKE_XCODE_ATTRIBUTE_GCC_GENERATE_DEBUGGING_SYMBOLS "YES")

set (CMAKE_XCODE_ATTRIBUTE_SWIFT_OBJC_INTEROP_MODE "objcxx")
set (CMAKE_XCODE_ATTRIBUTE_SWIFT_VERSION "5.0")

set (CMAKE_XCODE_ATTRIBUTE_DEAD_CODE_STRIPPING "$<IF:$<CONFIG:DEBUG>,NO,YES>")
set (CMAKE_XCODE_ATTRIBUTE_DEPLOYMENT_POSTPROCESSING "$<IF:$<CONFIG:DEBUG>,NO,YES>")
set (CMAKE_XCODE_ATTRIBUTE_STRIP_INSTALLED_PRODUCT "$<IF:$<CONFIG:DEBUG>,NO,YES>")
set (CMAKE_XCODE_ATTRIBUTE_STRIP_STYLE "$<IF:$<CONFIG:DEBUG>,debugging,non-global>")
set (CMAKE_XCODE_ATTRIBUTE_COPY_PHASE_STRIP "NO")

set (CMAKE_XCODE_ATTRIBUTE_CLANG_LINK_OBJC_RUNTIME "NO")
set (CMAKE_XCODE_ATTRIBUTE_SKIP_INSTALL "YES")

string ( REPLACE "-Wl,-search_paths_first" "" CMAKE_C_LINK_FLAGS ${CMAKE_C_LINK_FLAGS} )
string ( REPLACE "-Wl,-search_paths_first" "" CMAKE_CXX_LINK_FLAGS ${CMAKE_CXX_LINK_FLAGS} )

string ( REPLACE "-Wl,-headerpad_max_install_names" "" CMAKE_C_LINK_FLAGS ${CMAKE_C_LINK_FLAGS} )
string ( REPLACE "-Wl,-headerpad_max_install_names" "" CMAKE_CXX_LINK_FLAGS ${CMAKE_CXX_LINK_FLAGS} )

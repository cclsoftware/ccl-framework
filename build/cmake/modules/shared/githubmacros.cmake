# download file from GitHub Release
function (download_from_github_release repository release_tag file_name destination)
	cmake_parse_arguments (github_download_params "PUBLIC" "RENAME" "" ${ARGN})
	if (github_download_params_RENAME)
		set (output_file "${destination}/${github_download_params_RENAME}")
	else ()
		set (output_file "${destination}/${file_name}")
	endif ()

	if(github_download_params_PUBLIC)
		file (MAKE_DIRECTORY "${destination}")
		file (DOWNLOAD "https://github.com/${repository}/releases/download/${release_tag}/${file_name}" "${output_file}" STATUS file_download_result)
		list (GET file_download_result 0 file_download_result_code)
		if (NOT ${file_download_result_code} EQUAL 0)
			list (GET file_download_result 1 file_download_result_message)
			message (WARNING "CMake failed to download ${file_name} with result ${file_download_result_message}.")
			return ()
		endif ()
	else ()
		find_program (github_cli_command gh)
		if (NOT github_cli_command)
			message (WARNING "Could not find GitHub CLI. Please install it from https://cli.github.com and run 'gh auth login' to authorize it.")
			return ()
		endif ()

		file (MAKE_DIRECTORY "${destination}")
		execute_process (COMMAND "${github_cli_command}" "release" "download" "${release_tag}" "--pattern" "${file_name}" "--repo" "${repository}" --output "${output_file}" WORKING_DIRECTORY "${destination}" TIMEOUT 240 RESULT_VARIABLE github_cli_result)
		if(github_cli_result)
			message (WARNING "GitHub CLI failed to download ${file_name} with result ${github_cli_result}.")
			return ()
		endif ()
	endif ()
endfunction ()
